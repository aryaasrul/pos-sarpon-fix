import{j as e,s as h}from"../assets/index-gqo0DhI4.js";import{r as c}from"./chunk-Dqgx_XrJ.js";import{V as d}from"./chunk-nGiK0_2R.js";import"./chunk-CqGYk7DY.js";import"./chunk-DsIAwHzQ.js";function M({isOpen:l,onClose:y,onSave:k,book:s}){const[i,x]=c.useState({title:"",author:"",publisher:"",isbn:"",category:"",purchase_price:"",selling_price:"",stock_quantity:"",description:""});c.useEffect(()=>{x(s?{...s,purchase_price:s.purchase_price||"",selling_price:s.selling_price||"",stock_quantity:s.stock_quantity||""}:{title:"",author:"",publisher:"",isbn:"",category:"",purchase_price:"",selling_price:"",stock_quantity:"",description:""})},[s,l]);const b=a=>{a.preventDefault();const p={...i,purchase_price:parseInt(i.purchase_price)||0,selling_price:parseInt(i.selling_price)||0,stock_quantity:parseInt(i.stock_quantity)||0};k(p)},o=(a,p)=>{x(g=>({...g,[a]:p}))};return l?e.jsx("div",{className:"modal-overlay",children:e.jsx("div",{className:"modal-content",style:{maxWidth:"700px",maxHeight:"90vh",overflowY:"auto"},children:e.jsxs("form",{onSubmit:b,children:[e.jsxs("h2",{children:[s?"Edit":"Tambah"," Buku"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Judul Buku *"}),e.jsx("input",{type:"text",value:i.title,onChange:a=>o("title",a.target.value),required:!0,placeholder:"Masukkan judul buku"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Penulis"}),e.jsx("input",{type:"text",value:i.author,onChange:a=>o("author",a.target.value),placeholder:"Nama penulis"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Penerbit"}),e.jsx("input",{type:"text",value:i.publisher,onChange:a=>o("publisher",a.target.value),placeholder:"Nama penerbit"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ISBN"}),e.jsx("input",{type:"text",value:i.isbn,onChange:a=>o("isbn",a.target.value),placeholder:"978-XXXXXXXXXX"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kategori"}),e.jsxs("select",{value:i.category,onChange:a=>o("category",a.target.value),style:{padding:"10px",border:"1px solid #ccc",borderRadius:"4px",boxSizing:"border-box",fontFamily:"Axiforma, sans-serif"},children:[e.jsx("option",{value:"",children:"Pilih Kategori"}),e.jsx("option",{value:"Novel",children:"Novel"}),e.jsx("option",{value:"Self-Help",children:"Self-Help"}),e.jsx("option",{value:"Business",children:"Business"}),e.jsx("option",{value:"Biography",children:"Biography"}),e.jsx("option",{value:"Science",children:"Science"}),e.jsx("option",{value:"Religion",children:"Religion"}),e.jsx("option",{value:"Children",children:"Children"}),e.jsx("option",{value:"Education",children:"Education"}),e.jsx("option",{value:"History",children:"History"}),e.jsx("option",{value:"Philosophy",children:"Philosophy"}),e.jsx("option",{value:"Psychology",children:"Psychology"}),e.jsx("option",{value:"Cooking",children:"Cooking"}),e.jsx("option",{value:"Art",children:"Art"}),e.jsx("option",{value:"Travel",children:"Travel"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Stok Awal/Tambah Stok"}),e.jsx("input",{type:"number",value:i.stock_quantity,onChange:a=>o("stock_quantity",a.target.value),required:!0,min:"0",placeholder:"Jumlah stok"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Harga Beli (Rp) *"}),e.jsx("input",{type:"number",value:i.purchase_price,onChange:a=>o("purchase_price",a.target.value),required:!0,min:"0",placeholder:"Harga pembelian"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Harga Jual (Rp) *"}),e.jsx("input",{type:"number",value:i.selling_price,onChange:a=>o("selling_price",a.target.value),required:!0,min:"0",placeholder:"Harga penjualan"})]})]}),e.jsxs("div",{className:"form-group",style:{gridColumn:"span 2"},children:[e.jsx("label",{children:"Deskripsi"}),e.jsx("textarea",{value:i.description,onChange:a=>o("description",a.target.value),rows:"3",placeholder:"Deskripsi buku (opsional)",style:{width:"100%",resize:"vertical",padding:"10px",border:"1px solid #ccc",borderRadius:"4px",fontFamily:"Axiforma, sans-serif"}})]}),i.purchase_price&&i.selling_price&&e.jsx("div",{style:{padding:"10px",backgroundColor:"#e8f5e8",borderRadius:"4px",marginTop:"10px"},children:e.jsxs("strong",{children:["Preview Keuntungan: Rp ",(parseInt(i.selling_price)-parseInt(i.purchase_price)).toLocaleString("id-ID")]})}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:y,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn-save",children:"Simpan"})]})]})})}):null}function W({isOpen:l,onClose:y,onSave:k,book:s}){const[i,x]=c.useState(""),[b,o]=c.useState(""),a=p=>{p.preventDefault(),k({book_id:s.id,quantity:parseInt(i),notes:b}),x(""),o("")};return l?e.jsx("div",{className:"modal-overlay",children:e.jsx("div",{className:"modal-content",style:{maxWidth:"400px"},children:e.jsxs("form",{onSubmit:a,children:[e.jsxs("h2",{children:["Tambah Stok: ",s==null?void 0:s.title]}),e.jsxs("p",{style:{color:"#666",fontSize:"14px"},children:["Stok saat ini: ",s==null?void 0:s.stock_quantity," buah"]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Jumlah Stok Tambahan *"}),e.jsx("input",{type:"number",value:i,onChange:p=>x(p.target.value),required:!0,min:"1",placeholder:"Jumlah yang akan ditambahkan"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Catatan"}),e.jsx("textarea",{value:b,onChange:p=>o(p.target.value),rows:"2",placeholder:"Catatan tambahan (opsional)",style:{width:"100%",resize:"vertical",padding:"10px",border:"1px solid #ccc",borderRadius:"4px",fontFamily:"Axiforma, sans-serif"}})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:y,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn-save",children:"Tambah Stok"})]})]})})}):null}function K(){const[l,y]=c.useState([]),[k,s]=c.useState(!0),[i,x]=c.useState(null),[b,o]=c.useState(!1),[a,p]=c.useState(!1),[g,j]=c.useState(null),[m,B]=c.useState(""),[v,R]=c.useState(""),[S,q]=c.useState("created_at"),f=async(r=!0)=>{r&&s(!0),x(null);try{const{data:{user:t},error:n}=await h.auth.getUser();if(n)throw new Error("Sesi tidak valid: "+n.message);if(!t)throw new Error("Silakan login untuk mengakses data buku");const{data:u,error:_}=await h.from("books").select("*").order(S,{ascending:S==="title"});if(_)throw new Error(`Gagal memuat buku: ${_.message}`);y(u||[])}catch(t){if(x(t.message),d.error(t.message),S!=="created_at")try{const{data:n,error:u}=await h.from("books").select("*");!u&&n&&(y(n),x(null),d.success("Data berhasil dimuat (mode fallback)"))}catch{}}finally{r&&s(!1)}};c.useEffect(()=>{f();const r=setInterval(()=>{f(!1)},3e4);return()=>clearInterval(r)},[S]);const T=async r=>{try{const{data:{user:t}}=await h.auth.getUser();if(!t)throw new Error("Sesi tidak valid, silakan login ulang.");const n={...r,user_id:t.id,updated_at:new Date().toISOString()};let u;if(g){if(u=await h.from("books").update(n).eq("id",g.id).select(),u.error)throw u.error;d.success("Buku berhasil diperbarui!")}else{if(u=await h.from("books").insert([n]).select(),u.error)throw u.error;d.success("Buku berhasil ditambahkan!")}o(!1),j(null),await f(!1)}catch(t){t.message.includes("permission")?d.error("Tidak memiliki izin untuk menyimpan data. Silakan hubungi administrator."):t.message.includes("network")?d.error("Koneksi bermasalah. Periksa internet Anda."):d.error("Gagal menyimpan buku: "+t.message)}},N=async r=>{try{const{data:{user:t}}=await h.auth.getUser();if(!t){d.error("Sesi tidak valid");return}const{error:n}=await h.from("books").update({stock_quantity:g.stock_quantity+r.quantity,updated_at:new Date().toISOString()}).eq("id",r.book_id);if(n)throw n;const{error:u}=await h.from("book_stock_movements").insert([{book_id:r.book_id,movement_type:"IN",quantity:r.quantity,reference_type:"ADJUSTMENT",notes:r.notes||"Manual stock addition",user_id:t.id}]);if(u)throw u;d.success(`Stok berhasil ditambahkan! +${r.quantity} buah`),p(!1),j(null),f()}catch(t){d.error("Gagal menambah stok: "+t.message)}},z=async r=>{const t=`Yakin ingin menghapus buku "${r.title}"?

⚠️ Data ini akan terhapus permanen dan tidak bisa dikembalikan!`;if(window.confirm(t))try{const{error:n}=await h.from("books").delete().eq("id",r.id);if(n)throw n;d.success(`Buku "${r.title}" berhasil dihapus!`),await f(!1)}catch(n){d.error("Gagal menghapus buku: "+n.message)}},I=()=>{d.loading("Menyinkronkan data...",{id:"refresh"}),f().then(()=>{d.success("Data berhasil disinkronkan!",{id:"refresh"})})},C=l.filter(r=>{const t=r.title.toLowerCase().includes(m.toLowerCase())||r.author&&r.author.toLowerCase().includes(m.toLowerCase())||r.isbn&&r.isbn.toLowerCase().includes(m.toLowerCase()),n=!v||r.category===v;return t&&n}),A=[...new Set(l.map(r=>r.category).filter(Boolean))].sort(),E=l.length,D=l.reduce((r,t)=>r+t.stock_quantity,0),H=l.reduce((r,t)=>r+t.selling_price*t.stock_quantity,0),w=l.filter(r=>r.stock_quantity<=5).length;return i&&!l.length?e.jsxs("div",{style:{padding:"40px 20px",textAlign:"center",color:"#dc3545"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"20px"},children:"⚠️"}),e.jsx("h3",{children:"Terjadi Kesalahan"}),e.jsx("p",{style:{marginBottom:"20px"},children:i}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"center"},children:[e.jsx("button",{onClick:()=>f(),style:{padding:"12px 24px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:"🔄 Coba Lagi"}),e.jsx("button",{onClick:()=>window.location.reload(),style:{padding:"12px 24px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:"🔄 Refresh Halaman"})]})]}):k?e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",flexDirection:"column",gap:"15px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",border:"3px solid #f3f3f3",borderTop:"3px solid #000",borderRadius:"50%",animation:"spin 1s linear infinite"}}),e.jsx("span",{children:"Memuat data buku..."}),e.jsx("style",{children:`
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
        `})]}):e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h1",{children:"📚 Manajemen Buku"}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:I,style:{padding:"10px 16px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:"🔄 Sync"}),e.jsx("button",{onClick:()=>o(!0),style:{padding:"12px 24px",backgroundColor:"#000",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"+ Tambah Buku"})]})]}),e.jsx("div",{style:{marginBottom:"20px",padding:"8px 12px",backgroundColor:l.length>0?"#d4edda":"#f8d7da",color:l.length>0?"#155724":"#721c24",borderRadius:"4px",fontSize:"12px"},children:l.length>0?`✅ Terhubung - ${l.length} buku dimuat`:"⚠️ Belum ada data atau koneksi bermasalah"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"15px",marginBottom:"25px"},children:[e.jsxs("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",padding:"20px",borderRadius:"8px",textAlign:"center"},children:[e.jsx("h3",{style:{margin:"0 0 5px 0",fontSize:"24px"},children:E}),e.jsx("p",{style:{margin:0,opacity:.9},children:"Total Buku"})]}),e.jsxs("div",{style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",color:"white",padding:"20px",borderRadius:"8px",textAlign:"center"},children:[e.jsx("h3",{style:{margin:"0 0 5px 0",fontSize:"24px"},children:D}),e.jsx("p",{style:{margin:0,opacity:.9},children:"Total Stok"})]}),e.jsxs("div",{style:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",color:"white",padding:"20px",borderRadius:"8px",textAlign:"center"},children:[e.jsxs("h3",{style:{margin:"0 0 5px 0",fontSize:"20px"},children:["Rp ",H.toLocaleString("id-ID")]}),e.jsx("p",{style:{margin:0,opacity:.9},children:"Nilai Inventori"})]}),e.jsxs("div",{style:{background:w>0?"linear-gradient(135deg, #fa709a 0%, #fee140 100%)":"linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)",color:w>0?"white":"#333",padding:"20px",borderRadius:"8px",textAlign:"center"},children:[e.jsx("h3",{style:{margin:"0 0 5px 0",fontSize:"24px"},children:w}),e.jsx("p",{style:{margin:0,opacity:.9},children:"Stok Rendah (≤5)"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr",gap:"15px",marginBottom:"20px",alignItems:"end"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"500"},children:"Cari Buku"}),e.jsx("input",{type:"text",placeholder:"Cari judul, penulis, atau ISBN...",value:m,onChange:r=>B(r.target.value),style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"500"},children:"Kategori"}),e.jsxs("select",{value:v,onChange:r=>R(r.target.value),style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px"},children:[e.jsx("option",{value:"",children:"Semua Kategori"}),A.map(r=>e.jsx("option",{value:r,children:r},r))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"500"},children:"Urutkan"}),e.jsxs("select",{value:S,onChange:r=>q(r.target.value),style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"14px"},children:[e.jsx("option",{value:"created_at",children:"Terbaru"}),e.jsx("option",{value:"title",children:"Judul A-Z"}),e.jsx("option",{value:"stock_quantity",children:"Stok Terendah"})]})]})]}),C.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"60px 20px",backgroundColor:"#f8f9fa",borderRadius:"12px",border:"2px dashed #dee2e6"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"15px"},children:"📚"}),e.jsx("h3",{style:{margin:"0 0 10px 0",color:"#495057"},children:m||v?"Tidak ditemukan":"Belum ada buku"}),e.jsx("p",{style:{margin:"0 0 20px 0",color:"#6c757d"},children:m||v?"Coba ubah kata kunci pencarian atau filter kategori":"Mulai tambahkan buku pertama untuk koleksi toko Anda"}),!m&&!v&&e.jsx("button",{onClick:()=>o(!0),style:{padding:"12px 24px",backgroundColor:"#000",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:"+ Tambah Buku Pertama"})]}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(350px, 1fr))",gap:"20px"},children:C.map(r=>e.jsxs("div",{style:{border:"1px solid #e9ecef",borderRadius:"12px",padding:"20px",backgroundColor:"white",boxShadow:"0 2px 4px rgba(0,0,0,0.04)",transition:"all 0.2s ease",position:"relative"},onMouseEnter:t=>{t.currentTarget.style.transform="translateY(-2px)",t.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.1)"},onMouseLeave:t=>{t.currentTarget.style.transform="translateY(0)",t.currentTarget.style.boxShadow="0 2px 4px rgba(0,0,0,0.04)"},children:[r.stock_quantity<=5&&e.jsx("div",{style:{position:"absolute",top:"15px",right:"15px",background:r.stock_quantity===0?"#dc3545":"#ffc107",color:r.stock_quantity===0?"white":"#000",padding:"4px 8px",borderRadius:"12px",fontSize:"10px",fontWeight:"bold"},children:r.stock_quantity===0?"HABIS":"STOK RENDAH"}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("h3",{style:{margin:"0 0 8px 0",fontSize:"18px",lineHeight:"1.3",color:"#212529"},children:r.title}),r.author&&e.jsxs("p",{style:{margin:"0 0 5px 0",color:"#6c757d",fontSize:"14px",fontStyle:"italic"},children:["oleh ",r.author]}),r.category&&e.jsx("span",{style:{background:"#e9ecef",padding:"4px 10px",borderRadius:"16px",fontSize:"12px",color:"#495057",fontWeight:"500"},children:r.category})]}),e.jsx("div",{style:{marginBottom:"15px"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",fontSize:"14px"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{color:"#6c757d"},children:"Harga Beli:"}),e.jsxs("div",{style:{fontWeight:"bold",color:"#dc3545"},children:["Rp ",r.purchase_price.toLocaleString("id-ID")]})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"#6c757d"},children:"Harga Jual:"}),e.jsxs("div",{style:{fontWeight:"bold",color:"#198754"},children:["Rp ",r.selling_price.toLocaleString("id-ID")]})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"#6c757d"},children:"Stok:"}),e.jsxs("div",{style:{fontWeight:"bold",color:r.stock_quantity>5?"#198754":r.stock_quantity>0?"#ffc107":"#dc3545"},children:[r.stock_quantity," buah"]})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"#6c757d"},children:"Profit/unit:"}),e.jsxs("div",{style:{fontWeight:"bold",color:"#0d6efd"},children:["Rp ",(r.selling_price-r.purchase_price).toLocaleString("id-ID")]})]})]})}),r.description&&e.jsx("div",{style:{marginBottom:"15px",padding:"12px",backgroundColor:"#f8f9fa",borderRadius:"6px",fontSize:"13px",color:"#495057",lineHeight:"1.4"},children:r.description.length>120?`${r.description.substring(0,120)}...`:r.description}),e.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>{j(r),o(!0)},style:{flex:1,padding:"8px 12px",backgroundColor:"#0d6efd",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"12px",fontWeight:"500"},children:"✏️ Edit"}),e.jsx("button",{onClick:()=>{j(r),p(!0)},style:{flex:1,padding:"8px 12px",backgroundColor:"#198754",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"12px",fontWeight:"500"},children:"📦 +Stok"}),e.jsx("button",{onClick:()=>z(r),style:{padding:"8px 12px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"12px",fontWeight:"500"},children:"🗑️"})]})]},r.id))}),e.jsx(M,{isOpen:b,onClose:()=>{o(!1),j(null)},onSave:T,book:g}),e.jsx(W,{isOpen:a,onClose:()=>{p(!1),j(null)},onSave:N,book:g}),e.jsx("style",{children:`
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
        
        .form-group input, .form-group select, .form-group textarea {
          width: 100%;
          padding: 10px;
          border: 1px solid #ccc;
          border-radius: 4px;
          box-sizing: border-box;
          font-family: 'Axiforma', sans-serif;
          font-size: 14px;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
          outline: none;
          border-color: #0d6efd;
          box-shadow: 0 0 0 2px rgba(13, 110, 253, 0.1);
        }
        
        .btn-save {
          background-color: #198754;
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
        }
        
        .btn-save:hover {
          background-color: #157347;
        }
        
        .btn-cancel {
          background-color: #6c757d;
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
        }
        
        .btn-cancel:hover {
          background-color: #5c636a;
        }
      `})]})}export{K as default};
