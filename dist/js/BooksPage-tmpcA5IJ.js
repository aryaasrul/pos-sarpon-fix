import{j as e,s as b}from"../assets/index-61PA5fo8.js";import{r as t}from"./chunk-Dqgx_XrJ.js";import"./chunk-CqGYk7DY.js";import"./chunk-DsIAwHzQ.js";import"./chunk-nGiK0_2R.js";function L({isOpen:i,onClose:p,onSave:N,book:n=null}){const[o,u]=t.useState(""),[r,h]=t.useState(""),[m,c]=t.useState(""),[f,x]=t.useState(""),[S,v]=t.useState(""),[j,d]=t.useState("");t.useEffect(()=>{var l,y,C;n?(u(n.title||""),h(n.author||""),c(n.isbn||""),x(((l=n.purchase_price)==null?void 0:l.toString())||""),v(((y=n.selling_price)==null?void 0:y.toString())||""),d(((C=n.stock_quantity)==null?void 0:C.toString())||"")):(u(""),h(""),c(""),x(""),v(""),d(""))},[n,i]);const g=l=>{l.preventDefault(),N({title:o,author:r,isbn:m,purchase_price:parseFloat(f)||0,selling_price:parseFloat(S)||0,stock_quantity:parseInt(j)||0})};return i?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:n?"Edit Buku":"Tambah Buku Baru"}),e.jsx("button",{className:"modal-close-btn",onClick:p,children:e.jsx("img",{src:"/icons/Close-Square.svg",alt:"Close"})})]}),e.jsxs("form",{onSubmit:g,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Judul Buku *"}),e.jsx("input",{type:"text",value:o,onChange:l=>u(l.target.value),placeholder:"Masukkan judul buku",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Penulis"}),e.jsx("input",{type:"text",value:r,onChange:l=>h(l.target.value),placeholder:"Masukkan nama penulis"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ISBN"}),e.jsx("input",{type:"text",value:m,onChange:l=>c(l.target.value),placeholder:"Masukkan ISBN"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Harga Beli *"}),e.jsx("input",{type:"number",value:f,onChange:l=>x(l.target.value),placeholder:"0",min:"0",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Harga Jual *"}),e.jsx("input",{type:"number",value:S,onChange:l=>v(l.target.value),placeholder:"0",min:"0",required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Stok Awal"}),e.jsx("input",{type:"number",value:j,onChange:l=>d(l.target.value),placeholder:"0",min:"0"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",onClick:p,className:"cancel-btn",children:"Batal"}),e.jsx("button",{type:"submit",className:"save-btn",children:n?"Update":"Simpan"})]})]})]})}):null}function E({isOpen:i,onClose:p,onSave:N,book:n}){const[o,u]=t.useState(""),[r,h]=t.useState("");t.useEffect(()=>{i||(u(""),h(""))},[i]);const m=c=>{c.preventDefault(),o&&parseInt(o)>0&&N(parseInt(o),r)};return!i||!n?null:e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Tambah Stok: ",n.title]}),e.jsx("button",{className:"modal-close-btn",onClick:p,children:e.jsx("img",{src:"/icons/Close-Square.svg",alt:"Close"})})]}),e.jsxs("form",{onSubmit:m,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Stok Saat Ini"}),e.jsx("input",{type:"text",value:`${n.stock_quantity} unit`,disabled:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Tambah Stok *"}),e.jsx("input",{type:"number",value:o,onChange:c=>u(c.target.value),placeholder:"Jumlah yang akan ditambahkan",min:"1",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Catatan"}),e.jsx("textarea",{value:r,onChange:c=>h(c.target.value),rows:"2",placeholder:"Catatan tambahan (opsional)"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",onClick:p,className:"cancel-btn",children:"Batal"}),e.jsx("button",{type:"submit",className:"save-btn",children:"Tambah Stok"})]})]})]})})}function R(){const[i,p]=t.useState([]),[N,n]=t.useState(!0),[o,u]=t.useState(null),[r,h]=t.useState(""),[m,c]=t.useState("created_at"),[f,x]=t.useState(!1),[S,v]=t.useState(!1),[j,d]=t.useState(null),g=async()=>{try{n(!0),u(null);const{data:s,error:a}=await b.from("books").select("*").order(m,{ascending:m==="title"});if(a)throw a;p(s||[])}catch(s){u(s.message)}finally{n(!1)}};t.useEffect(()=>{g()},[m]);const l=async s=>{try{let a;if(j){const{error:k}=await b.from("books").update(s).eq("id",j.id);a=k}else{const{error:k}=await b.from("books").insert([s]);a=k}if(a)throw a;x(!1),d(null),g()}catch(a){alert(`Gagal menyimpan buku: ${a.message}`)}},y=async s=>{if(window.confirm(`Yakin ingin menghapus buku "${s.title}"?`))try{const{error:a}=await b.from("books").delete().eq("id",s.id);if(a)throw a;g()}catch(a){alert(`Gagal menghapus buku: ${a.message}`)}},C=async(s,a)=>{try{const k=j.stock_quantity+s,{error:w}=await b.from("books").update({stock_quantity:k}).eq("id",j.id);if(w)throw w;v(!1),d(null),g()}catch(k){alert(`Gagal menambah stok: ${k.message}`)}},B=i.filter(s=>s.title.toLowerCase().includes(r.toLowerCase())||s.author&&s.author.toLowerCase().includes(r.toLowerCase())||s.isbn&&s.isbn.toLowerCase().includes(r.toLowerCase())),q=i.length,_=i.reduce((s,a)=>s+a.stock_quantity,0),T=i.reduce((s,a)=>s+a.selling_price*a.stock_quantity,0),I=i.filter(s=>s.stock_quantity<=5).length;return o&&!i.length?e.jsx("div",{className:"books-page",children:e.jsxs("div",{className:"error-state",children:[e.jsx("div",{className:"error-icon",children:"⚠️"}),e.jsx("h3",{children:"Terjadi Kesalahan"}),e.jsx("p",{children:o}),e.jsxs("div",{className:"error-actions",children:[e.jsx("button",{onClick:g,className:"retry-btn",children:"🔄 Coba Lagi"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"refresh-btn",children:"🔄 Refresh Halaman"})]})]})}):N?e.jsx("div",{className:"books-page",children:e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner",children:e.jsx("img",{src:"/icons/Loading.svg",alt:"Loading",className:"spinning"})}),e.jsx("p",{className:"loading-text",children:"Memuat data buku..."})]})}):e.jsxs("div",{className:"books-page",children:[e.jsxs("div",{className:"books-header",children:[e.jsx("h1",{children:"Manajemen Buku"}),e.jsxs("button",{onClick:()=>x(!0),className:"btn-add-book",children:[e.jsx("img",{src:"/icons/icon-plus-input-manual.svg",alt:"Tambah"}),e.jsx("span",{children:"Tambah Buku"})]})]}),e.jsx("div",{className:`connection-status ${i.length>0?"connected":"disconnected"}`,children:i.length>0?`✅ Terhubung - ${i.length} buku dimuat`:"⚠️ Belum ada data atau koneksi bermasalah"}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card total-books",children:[e.jsx("div",{className:"stat-number",children:q}),e.jsx("div",{className:"stat-label",children:"Total Buku"})]}),e.jsxs("div",{className:"stat-card total-stock",children:[e.jsx("div",{className:"stat-number",children:_}),e.jsx("div",{className:"stat-label",children:"Total Stok"})]}),e.jsxs("div",{className:"stat-card total-value",children:[e.jsxs("div",{className:"stat-number",children:["Rp ",T.toLocaleString("id-ID")]}),e.jsx("div",{className:"stat-label",children:"Nilai Inventori"})]}),e.jsxs("div",{className:"stat-card low-stock",children:[e.jsx("div",{className:"stat-number",children:I}),e.jsx("div",{className:"stat-label",children:"Stok Rendah (≤5)"})]})]}),e.jsxs("div",{className:"search-filter-container",children:[e.jsxs("div",{className:"search-group",children:[e.jsx("label",{children:"Cari Buku"}),e.jsxs("div",{className:"search-input-container",children:[e.jsx("img",{src:"/icons/Search.svg",alt:"Search",className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"Cari judul, penulis, atau ISBN...",value:r,onChange:s=>h(s.target.value)}),r&&e.jsx("button",{className:"clear-search-btn",onClick:()=>h(""),children:e.jsx("img",{src:"/icons/Close-Square.svg",alt:"Clear"})})]})]}),e.jsxs("div",{className:"sort-group",children:[e.jsx("label",{children:"Urutkan"}),e.jsxs("select",{value:m,onChange:s=>c(s.target.value),children:[e.jsx("option",{value:"created_at",children:"Terbaru"}),e.jsx("option",{value:"title",children:"Judul A-Z"}),e.jsx("option",{value:"stock_quantity",children:"Stok Terendah"})]})]})]}),B.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"📚"}),e.jsx("h3",{children:r?"Tidak ditemukan":"Belum ada buku"}),e.jsx("p",{children:r?"Coba ubah kata kunci pencarian":"Mulai tambahkan buku pertama untuk koleksi toko Anda"}),!r&&e.jsx("button",{onClick:()=>x(!0),className:"add-first-book-btn",children:"+ Tambah Buku Pertama"})]}):e.jsx("div",{className:"books-grid",children:B.map(s=>e.jsxs("div",{className:"book-card",children:[s.stock_quantity<=5&&e.jsx("div",{className:`stock-badge ${s.stock_quantity===0?"out-of-stock":"low-stock"}`,children:s.stock_quantity===0?"HABIS":"STOK RENDAH"}),e.jsxs("div",{className:"book-info",children:[e.jsx("h3",{className:"book-title",children:s.title}),s.author&&e.jsxs("p",{className:"book-author",children:["oleh ",s.author]}),s.isbn&&e.jsxs("p",{className:"book-isbn",children:["ISBN: ",s.isbn]})]}),e.jsxs("div",{className:"book-details",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("div",{className:"detail-label",children:"Harga Beli"}),e.jsxs("div",{className:"detail-value price-buy",children:["Rp ",s.purchase_price.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("div",{className:"detail-label",children:"Harga Jual"}),e.jsxs("div",{className:"detail-value price-sell",children:["Rp ",s.selling_price.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("div",{className:"detail-label",children:"Stok"}),e.jsxs("div",{className:`detail-value ${s.stock_quantity>5?"stock-good":s.stock_quantity>0?"stock-low":"stock-out"}`,children:[s.stock_quantity," unit"]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("div",{className:"detail-label",children:"Profit/Unit"}),e.jsxs("div",{className:"detail-value",children:["Rp ",(s.selling_price-s.purchase_price).toLocaleString("id-ID")]})]})]}),e.jsxs("div",{className:"book-actions",children:[e.jsx("button",{onClick:()=>{d(s),x(!0)},className:"edit-book-btn",children:"Edit"}),e.jsx("button",{onClick:()=>{d(s),v(!0)},className:"add-stock-btn",children:"+ Stok"}),e.jsx("button",{onClick:()=>y(s),className:"delete-book-btn",children:"Hapus"})]})]},s.id))}),e.jsx(L,{isOpen:f,onClose:()=>{x(!1),d(null)},onSave:l,book:j}),e.jsx(E,{isOpen:S,onClose:()=>{v(!1),d(null)},onSave:C,book:j})]})}export{R as default};
