import{j as e,s as j}from"../assets/index-61PA5fo8.js";import{r as n}from"./chunk-Dqgx_XrJ.js";import{V as h}from"./chunk-nGiK0_2R.js";import"./chunk-CqGYk7DY.js";import"./chunk-DsIAwHzQ.js";function D({isOpen:y,onClose:w,onSave:M,ingredient:t}){const[g,x]=n.useState(""),[s,b]=n.useState("filter_bean"),[c,m]=n.useState(""),[C,f]=n.useState(""),[E,o]=n.useState(""),[p,$]=n.useState(!0),[N,_]=n.useState(""),[S,B]=n.useState(!1);n.useEffect(()=>{t?(x(t.name||""),b(t.category||"filter_bean"),m(t.purchase_price||""),f(t.pack_size_grams||""),o(t.current_stock_grams||""),$(!1),_("")):(x(""),b("filter_bean"),m(""),f("1000"),o("0"),$(!0),_("25"))},[t,y]),n.useEffect(()=>{t||_(s==="espresso_bean"?"18":s==="filter_bean"?"25":"10")},[s,t]);const F=async(i,k,v)=>{try{let d=[];if(k==="espresso_bean"){const{data:l,error:u}=await j.from("menu_items").select("id, name").eq("category","espresso_based");if(u)throw u;d=l.map(T=>({id:T.id,name:T.name}))}else if(k==="filter_bean"){const{data:l,error:u}=await j.from("menu_items").select("id, name").eq("category","filter");if(u)throw u;d=l.map(T=>({id:T.id,name:T.name}))}if(d.length===0)return;const a=d.map(l=>({menu_item_id:l.id,ingredient_id:i,quantity_grams:parseFloat(v)})),{error:r}=await j.from("recipe_ingredients").insert(a);if(r)if(r.code==="23505")h.success("Beans berhasil ditambahkan! (Beberapa resep sudah ada)");else throw r;else h.success(`Beans berhasil ditambahkan ke ${d.length} menu!`)}catch(d){h.error(`Recipe creation gagal: ${d.message}`)}},q=async i=>{i.preventDefault(),B(!0);try{const k={name:g.trim(),category:s,purchase_price:parseFloat(c)||0,pack_size_grams:parseInt(C,10)||1e3,current_stock_grams:parseInt(E,10)||0};if(t){const{error:v}=await j.from("ingredients").update(k).eq("id",t.id);if(v)throw v;h.success(`Bahan baku "${g}" berhasil diperbarui!`)}else{const{data:v,error:d}=await j.from("ingredients").insert([k]).select().single();if(d)throw d;p&&N&&await F(v.id,s,N),h.success(`Bahan baku "${g}" berhasil ditambahkan!`)}M()}catch(k){h.error(`Gagal menyimpan: ${k.message}`)}finally{B(!1)}};return y?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[t?"Edit":"Tambah"," Bahan Baku"]}),e.jsx("button",{className:"modal-close-btn",onClick:w,children:e.jsx("img",{src:"/icons/Close-Square.svg",alt:"Close"})})]}),e.jsxs("form",{onSubmit:q,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nama Bahan *"}),e.jsx("input",{type:"text",value:g,onChange:i=>x(i.target.value),placeholder:"Contoh: Beans Pinara Premium",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Kategori Bahan *"}),e.jsxs("select",{value:s,onChange:i=>b(i.target.value),required:!0,children:[e.jsx("option",{value:"filter_bean",children:"Filter Bean (Manual Brew)"}),e.jsx("option",{value:"espresso_bean",children:"Espresso Bean (Mesin Espresso)"}),e.jsx("option",{value:"other",children:"Lainnya"})]}),e.jsxs("small",{className:"form-help",children:[s==="filter_bean"&&"🔹 Akan otomatis ditambahkan ke menu Filter",s==="espresso_bean"&&"🔹 Akan otomatis ditambahkan ke menu Espresso-based",s==="other"&&"🔹 Tidak akan ditambahkan ke menu secara otomatis"]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Harga Beli (Rp) *"}),e.jsx("input",{type:"number",value:c,onChange:i=>m(i.target.value),placeholder:"125000",min:"0",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Ukuran Kemasan (gram) *"}),e.jsx("input",{type:"number",value:C,onChange:i=>f(i.target.value),placeholder:"1000",min:"1",required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Stok Awal (gram)"}),e.jsx("input",{type:"number",value:E,onChange:i=>o(i.target.value),placeholder:"0",min:"0"})]}),!t&&(s==="filter_bean"||s==="espresso_bean")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:i=>$(i.target.checked)}),e.jsx("span",{className:"checkmark"}),"Otomatis tambahkan ke menu yang sesuai"]}),e.jsx("small",{className:"form-help",children:"✨ Beans akan langsung tersedia di halaman kasir dengan perhitungan harga otomatis"})]}),p&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Takaran Default per Menu (gram)"}),e.jsx("input",{type:"number",value:N,onChange:i=>_(i.target.value),placeholder:s==="espresso_bean"?"18":"25",min:"1",step:"0.5"}),e.jsx("small",{className:"form-help",children:s==="espresso_bean"?"☕ Standar espresso: 18-20 gram per shot":"🔍 Standar manual brew: 20-30 gram per cup"})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",onClick:w,className:"cancel-btn",disabled:S,children:"Batal"}),e.jsx("button",{type:"submit",className:"save-btn",disabled:S,children:S?"Menyimpan...":t?"Update":"Simpan"})]})]})]})}):null}function R({isOpen:y,onClose:w,onSave:M,menuItem:t}){const[g,x]=n.useState(""),[s,b]=n.useState(""),[c,m]=n.useState(""),[C,f]=n.useState("");n.useEffect(()=>{t?(x(t.name||""),b(t.fixed_cost||""),m(t.profit_margin||""),f(t.rounding_up||"")):(x(""),b("1600"),m("0.5"),f("500"))},[t,y]);const E=o=>{o.preventDefault();const p={name:g,fixed_cost:parseInt(s,10),profit_margin:parseFloat(c),rounding_up:parseInt(C,10)};M(p)};return y?e.jsx("div",{className:"modal-overlay",children:e.jsx("div",{className:"modal-content",children:e.jsxs("form",{onSubmit:E,children:[e.jsxs("h2",{children:[t?"Edit":"Tambah"," Menu Jualan"]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nama Menu (mis: Manual Brew)"}),e.jsx("input",{type:"text",value:g,onChange:o=>x(o.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Biaya Tetap (Rp)"}),e.jsx("input",{type:"number",value:s,onChange:o=>b(o.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Margin Profit (contoh: 0.5 untuk 50%)"}),e.jsx("input",{type:"number",step:"0.01",value:c,onChange:o=>m(o.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Pembulatan Harga (contoh: 500)"}),e.jsx("input",{type:"number",step:"100",value:C,onChange:o=>f(o.target.value),required:!0})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:w,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn-save",children:"Simpan"})]})]})})}):null}function O(){const[y,w]=n.useState([]),[M,t]=n.useState([]),[g,x]=n.useState(!0),[s,b]=n.useState("ingredients"),[c,m]=n.useState(""),[C,f]=n.useState(!1),[E,o]=n.useState(!1),[p,$]=n.useState(null),N=async()=>{x(!0);try{const{data:a,error:r}=await j.from("ingredients").select("*").order("created_at",{ascending:!1});if(r)throw r;w(a||[]);const{data:l,error:u}=await j.from("menu_items").select("*").order("created_at",{ascending:!1});if(u)throw u;t(l||[])}catch{h.error("Gagal mengambil data katalog")}finally{x(!1)}};n.useEffect(()=>{N()},[]);const _=()=>{const a=s==="ingredients"?y:M;return c?a.filter(r=>r.name.toLowerCase().includes(c.toLowerCase())):a},S=(a=null)=>{$(a),s==="ingredients"?f(!0):o(!0)},B=()=>{f(!1),o(!1),$(null)},F=async(a=null)=>{B(),await N()},q=async a=>{try{let r;if(p){const{error:l}=await j.from("menu_items").update(a).eq("id",p.id);r=l}else{const{error:l}=await j.from("menu_items").insert([a]);r=l}r?h.error(r.message):(h.success(`Menu ${p?"diperbarui":"ditambahkan"} berhasil!`),B(),N())}catch{h.error("Gagal menyimpan menu item")}},i=async a=>{const r=s==="ingredients"?"bahan baku":"menu";if(window.confirm(`Yakin ingin menghapus ${r} "${a.name}"?`))try{const l=s==="ingredients"?"ingredients":"menu_items",{error:u}=await j.from(l).delete().eq("id",a.id);if(u)throw u;h.success(`${r} "${a.name}" berhasil dihapus`),N()}catch(l){h.error(`Gagal menghapus ${r}: ${l.message}`)}},k=a=>{switch(a){case"espresso_bean":return"☕ Espresso Bean";case"filter_bean":return"🔍 Filter Bean";case"other":return"📦 Lainnya";default:return a}},v=a=>{switch(a){case"espresso_bean":return"#8B4513";case"filter_bean":return"#228B22";case"other":return"#888";default:return"#888"}},d=_();return e.jsxs("div",{className:"katalog-page",children:[e.jsxs("div",{className:"katalog-header",children:[e.jsx("h1",{children:"Katalog"}),e.jsxs("button",{onClick:()=>S(),className:"btn-add-product",children:[e.jsx("img",{src:"/icons/icon-plus-input-manual.svg",alt:"Tambah"}),e.jsxs("span",{children:["Tambah ",s==="ingredients"?"Bahan Baku":"Menu"]})]})]}),e.jsxs("div",{className:"search-container",children:[e.jsx("div",{className:"search-bar",children:e.jsxs("div",{className:"search-input-container",children:[e.jsx("img",{src:"/icons/Search.svg",alt:"Search",className:"search-icon"}),e.jsx("input",{type:"text",placeholder:`Cari ${s==="ingredients"?"bahan baku":"menu"}...`,value:c,onChange:a=>m(a.target.value)}),c&&e.jsx("button",{className:"clear-search-btn",onClick:()=>m(""),children:e.jsx("img",{src:"/icons/Close-Square.svg",alt:"Clear"})})]})}),e.jsx("button",{className:"btn-filter",children:e.jsx("img",{src:"/icons/Filter.svg",alt:"Filter"})})]}),e.jsxs("div",{className:"tab-container",children:[e.jsxs("button",{className:`tab-btn ${s==="ingredients"?"active":""}`,onClick:()=>{b("ingredients"),m("")},children:[e.jsx("img",{src:"/icons/database-icon.svg",alt:"Bahan Baku",className:"tab-icon"}),"Bahan Baku (",y.length,")"]}),e.jsxs("button",{className:`tab-btn ${s==="menuItems"?"active":""}`,onClick:()=>{b("menuItems"),m("")},children:[e.jsx("img",{src:"/icons/laporan-icon.svg",alt:"Menu",className:"tab-icon"}),"Menu Jualan (",M.length,")"]})]}),g&&e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner",children:e.jsx("img",{src:"/icons/Loading.svg",alt:"Loading",className:"spinning"})}),e.jsx("p",{style:{color:"#666",fontFamily:"Axiforma",fontWeight:"500"},children:"Memuat data katalog..."})]}),!g&&e.jsx(e.Fragment,{children:d.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("img",{src:s==="ingredients"?"/icons/database-icon.svg":"/icons/laporan-icon.svg",alt:"Empty",className:"empty-icon"}),e.jsx("h3",{children:c?`Tidak ditemukan "${c}"`:`Belum ada ${s==="ingredients"?"bahan baku":"menu"}`}),e.jsx("p",{children:c?`Coba kata kunci lain untuk ${s==="ingredients"?"bahan baku":"menu"}`:`Mulai tambahkan ${s==="ingredients"?"bahan baku":"menu"} pertama Anda`}),!c&&e.jsxs("button",{onClick:()=>S(),className:"add-first-item-btn",children:[e.jsx("img",{src:"/icons/icon-plus-input-manual.svg",alt:"Tambah"}),"Tambah ",s==="ingredients"?"Bahan Baku":"Menu"," Pertama"]})]}):e.jsx("div",{className:"katalog-grid",children:s==="ingredients"?d.map(a=>{var r;return e.jsxs("div",{className:"katalog-card",children:[e.jsx("div",{className:"katalog-card-image-placeholder",children:e.jsx("div",{className:"category-indicator",style:{backgroundColor:v(a.category),color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"10px",fontWeight:"bold",position:"absolute",top:"8px",right:"8px"},children:a.category==="espresso_bean"?"☕":a.category==="filter_bean"?"🔍":"📦"})}),e.jsxs("div",{className:"katalog-card-details",children:[e.jsx("h3",{children:a.name}),e.jsxs("p",{style:{marginBottom:"4px"},children:[e.jsxs("strong",{children:["Rp ",((r=a.purchase_price)==null?void 0:r.toLocaleString("id-ID"))||"0"]})," / ",a.pack_size_grams||0,"g"]}),e.jsx("p",{style:{fontSize:"12px",color:v(a.category),margin:"0 0 4px 0",fontWeight:"500"},children:k(a.category)}),e.jsxs("p",{style:{fontSize:"12px",color:"#999",margin:"0"},children:["Stok: ",a.current_stock_grams||0,"g"]})]}),e.jsxs("div",{className:"katalog-card-actions",children:[e.jsx("button",{onClick:()=>S(a),className:"edit-btn",children:"Edit"}),e.jsx("button",{onClick:()=>i(a),className:"delete-btn",children:"Hapus"})]})]},a.id)}):d.map(a=>{var r,l,u;return e.jsxs("div",{className:"katalog-card",children:[e.jsx("div",{className:"katalog-card-image-placeholder",children:e.jsx("div",{className:"category-indicator",style:{backgroundColor:a.category==="espresso_based"?"#8B4513":a.category==="filter"?"#228B22":a.category==="local_proses"?"#FF6B35":"#6C5CE7",color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"10px",fontWeight:"bold",position:"absolute",top:"8px",right:"8px"},children:a.category==="espresso_based"?"☕":a.category==="filter"?"🔍":a.category==="local_proses"?"🏛️":"🥤"})}),e.jsxs("div",{className:"katalog-card-details",children:[e.jsx("h3",{children:a.name}),e.jsx("p",{style:{marginBottom:"4px"},children:e.jsxs("strong",{children:["Biaya Tetap: Rp ",((r=a.fixed_cost)==null?void 0:r.toLocaleString("id-ID"))||"0"]})}),e.jsxs("p",{style:{fontSize:"12px",color:"#666",margin:"0 0 4px 0"},children:["Margin: ",((a.profit_margin||0)*100).toFixed(0),"% | Pembulatan: Rp ",((l=a.rounding_up)==null?void 0:l.toLocaleString("id-ID"))||"0"]}),e.jsxs("p",{style:{fontSize:"12px",color:"#999",margin:"0",textTransform:"capitalize"},children:["Kategori: ",((u=a.category)==null?void 0:u.replace("_"," "))||"Tidak dikategorikan"]})]}),e.jsxs("div",{className:"katalog-card-actions",children:[e.jsx("button",{onClick:()=>S(a),className:"edit-btn",children:"Edit"}),e.jsx("button",{onClick:()=>i(a),className:"delete-btn",children:"Hapus"})]})]},a.id)})})}),e.jsx(D,{isOpen:C,onClose:B,onSave:F,ingredient:p}),e.jsx(R,{isOpen:E,onClose:B,onSave:q,menuItem:p})]})}export{O as default};
