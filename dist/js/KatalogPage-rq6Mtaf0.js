import{j as e,s as N}from"../assets/index-DrDxRAF3.js";import{r as t}from"./chunk-Dqgx_XrJ.js";import"./chunk-CqGYk7DY.js";import"./chunk-DsIAwHzQ.js";import"./chunk-nGiK0_2R.js";function E({isOpen:p,onClose:v,onSave:x,ingredient:n}){const[g,u]=t.useState(""),[s,m]=t.useState(""),[r,c]=t.useState("");t.useEffect(()=>{n?(u(n.name||""),m(n.purchase_price||""),c(n.pack_size_grams||"")):(u(""),m(""),c(""))},[n,p]);const j=l=>{l.preventDefault();const f={name:g,purchase_price:parseInt(s,10),pack_size_grams:parseInt(r,10)};x(f)};return p?e.jsx("div",{className:"modal-overlay",children:e.jsx("div",{className:"modal-content",children:e.jsxs("form",{onSubmit:j,children:[e.jsxs("h2",{children:[n?"Edit":"Tambah"," Bahan Baku"]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nama Bahan (mis: Beans Pinara)"}),e.jsx("input",{type:"text",value:g,onChange:l=>u(l.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Harga Beli (Rp)"}),e.jsx("input",{type:"number",value:s,onChange:l=>m(l.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Ukuran Kemasan (gram)"}),e.jsx("input",{type:"number",value:r,onChange:l=>c(l.target.value),required:!0})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:v,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn-save",children:"Simpan"})]})]})})}):null}function w({isOpen:p,onClose:v,onSave:x,menuItem:n}){const[g,u]=t.useState(""),[s,m]=t.useState(""),[r,c]=t.useState(""),[j,l]=t.useState("");t.useEffect(()=>{n?(u(n.name||""),m(n.fixed_cost||""),c(n.profit_margin||""),l(n.rounding_up||"")):(u(""),m("1600"),c("0.5"),l("500"))},[n,p]);const f=o=>{o.preventDefault();const b={name:g,fixed_cost:parseInt(s,10),profit_margin:parseFloat(r),rounding_up:parseInt(j,10)};x(b)};return p?e.jsx("div",{className:"modal-overlay",children:e.jsx("div",{className:"modal-content",children:e.jsxs("form",{onSubmit:f,children:[e.jsxs("h2",{children:[n?"Edit":"Tambah"," Menu Jualan"]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nama Menu (mis: Manual Brew)"}),e.jsx("input",{type:"text",value:g,onChange:o=>u(o.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Biaya Tetap (Rp)"}),e.jsx("input",{type:"number",value:s,onChange:o=>m(o.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Margin Profit (contoh: 0.5 untuk 50%)"}),e.jsx("input",{type:"number",step:"0.01",value:r,onChange:o=>c(o.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Pembulatan Harga (contoh: 500)"}),e.jsx("input",{type:"number",step:"100",value:j,onChange:o=>l(o.target.value),required:!0})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:v,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn-save",children:"Simpan"})]})]})})}):null}function F(){const[p,v]=t.useState([]),[x,n]=t.useState([]),[g,u]=t.useState(!0),[s,m]=t.useState("ingredients"),[r,c]=t.useState(""),[j,l]=t.useState(!1),[f,o]=t.useState(!1),[b,M]=t.useState(null),S=async()=>{u(!0);try{const{data:a,error:i}=await N.from("ingredients").select("*");if(i)throw i;v(a||[]);const{data:d,error:h}=await N.from("menu_items").select("*");if(h)throw h;n(d||[])}catch{}finally{u(!1)}};t.useEffect(()=>{S()},[]);const T=()=>{const a=s==="ingredients"?p:x;return r?a.filter(i=>i.name.toLowerCase().includes(r.toLowerCase())):a},k=(a=null)=>{M(a),s==="ingredients"?l(!0):o(!0)},y=()=>{l(!1),o(!1),M(null)},B=async a=>{const i=s==="ingredients"?"ingredients":"menu_items";let d;if(b){const{error:h}=await N.from(i).update(a).eq("id",b.id);d=h}else{const{error:h}=await N.from(i).insert([a]);d=h}d?alert(d.message):(y(),S())},_=async a=>{const i=s==="ingredients"?"bahan baku":"menu";if(window.confirm(`Yakin ingin menghapus ${i} "${a.name}"?`)){const d=s==="ingredients"?"ingredients":"menu_items",{error:h}=await N.from(d).delete().eq("id",a.id);h?alert(h.message):S()}},C=T();return e.jsxs("div",{className:"katalog-page",children:[e.jsxs("div",{className:"katalog-header",children:[e.jsx("h1",{children:"Katalog"}),e.jsxs("button",{onClick:()=>k(),className:"btn-add-product",children:[e.jsx("img",{src:"/icons/icon-plus-input-manual.svg",alt:"Tambah"}),e.jsxs("span",{children:["Tambah ",s==="ingredients"?"Bahan Baku":"Menu"]})]})]}),e.jsxs("div",{className:"search-container",children:[e.jsx("div",{className:"search-bar",children:e.jsxs("div",{className:"search-input-container",children:[e.jsx("img",{src:"/icons/Search.svg",alt:"Search",className:"search-icon"}),e.jsx("input",{type:"text",placeholder:`Cari ${s==="ingredients"?"bahan baku":"menu"}...`,value:r,onChange:a=>c(a.target.value)}),r&&e.jsx("button",{className:"clear-search-btn",onClick:()=>c(""),children:e.jsx("img",{src:"/icons/Close-Square.svg",alt:"Clear"})})]})}),e.jsx("button",{className:"btn-filter",children:e.jsx("img",{src:"/icons/Filter.svg",alt:"Filter"})})]}),e.jsxs("div",{className:"tab-container",children:[e.jsxs("button",{className:`tab-btn ${s==="ingredients"?"active":""}`,onClick:()=>{m("ingredients"),c("")},children:[e.jsx("img",{src:"/icons/database-icon.svg",alt:"Bahan Baku",className:"tab-icon"}),"Bahan Baku (",p.length,")"]}),e.jsxs("button",{className:`tab-btn ${s==="menuItems"?"active":""}`,onClick:()=>{m("menuItems"),c("")},children:[e.jsx("img",{src:"/icons/laporan-icon.svg",alt:"Menu",className:"tab-icon"}),"Menu Jualan (",x.length,")"]})]}),g&&e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner",children:e.jsx("img",{src:"/icons/Loading.svg",alt:"Loading",className:"spinning"})}),e.jsx("p",{style:{color:"#666",fontFamily:"Axiforma",fontWeight:"500"},children:"Memuat data katalog..."})]}),!g&&e.jsx(e.Fragment,{children:C.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("img",{src:s==="ingredients"?"/icons/database-icon.svg":"/icons/laporan-icon.svg",alt:"Empty",className:"empty-icon"}),e.jsx("h3",{children:r?`Tidak ditemukan "${r}"`:`Belum ada ${s==="ingredients"?"bahan baku":"menu"}`}),e.jsx("p",{children:r?`Coba kata kunci lain untuk ${s==="ingredients"?"bahan baku":"menu"}`:`Mulai tambahkan ${s==="ingredients"?"bahan baku":"menu"} pertama Anda`}),!r&&e.jsxs("button",{onClick:()=>k(),className:"add-first-item-btn",children:[e.jsx("img",{src:"/icons/icon-plus-input-manual.svg",alt:"Tambah"}),"Tambah ",s==="ingredients"?"Bahan Baku":"Menu"," Pertama"]})]}):e.jsx("div",{className:"katalog-grid",children:s==="ingredients"?C.map(a=>{var i,d;return e.jsxs("div",{className:"katalog-card",children:[e.jsx("div",{className:"katalog-card-image-placeholder"}),e.jsxs("div",{className:"katalog-card-details",children:[e.jsx("h3",{children:a.name}),e.jsxs("p",{children:["Rp ",((i=a.purchase_price)==null?void 0:i.toLocaleString("id-ID"))||"0"," / ",a.pack_size_grams||0,"g"]}),e.jsxs("p",{style:{fontSize:"12px",color:"#999",marginTop:"4px"},children:["HPP: Rp ",((d=a.hpp)==null?void 0:d.toLocaleString("id-ID"))||"0"," per gram"]})]}),e.jsxs("div",{className:"katalog-card-actions",children:[e.jsx("button",{onClick:()=>k(a),className:"edit-btn",children:"Edit"}),e.jsx("button",{onClick:()=>_(a),className:"delete-btn",children:"Hapus"})]})]},a.id)}):C.map(a=>{var i;return e.jsxs("div",{className:"katalog-card",children:[e.jsx("div",{className:"katalog-card-image-placeholder"}),e.jsxs("div",{className:"katalog-card-details",children:[e.jsx("h3",{children:a.name}),e.jsxs("p",{children:["Biaya Tetap: Rp ",((i=a.fixed_cost)==null?void 0:i.toLocaleString("id-ID"))||"0"]}),e.jsxs("p",{style:{fontSize:"12px",color:"#999",marginTop:"4px"},children:["Kategori: ",a.category||"Tidak dikategorikan"]})]}),e.jsxs("div",{className:"katalog-card-actions",children:[e.jsx("button",{onClick:()=>k(a),className:"edit-btn",children:"Edit"}),e.jsx("button",{onClick:()=>_(a),className:"delete-btn",children:"Hapus"})]})]},a.id)})})}),e.jsx(E,{isOpen:j,onClose:y,onSave:B,ingredient:b}),e.jsx(w,{isOpen:f,onClose:y,onSave:B,menuItem:b})]})}export{F as default};
