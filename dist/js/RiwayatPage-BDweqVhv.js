import{j as e,s as f}from"../assets/index-gqo0DhI4.js";import{r as l}from"./chunk-Dqgx_XrJ.js";import{V as b}from"./chunk-nGiK0_2R.js";import"./chunk-CqGYk7DY.js";import"./chunk-DsIAwHzQ.js";function I({isOpen:d,onClose:o,onSave:i}){const[m,u]=l.useState(""),[p,h]=l.useState(""),j=c=>{if(c.preventDefault(),!m||!p){alert("Nama dan jumlah pengeluaran harus diisi.");return}const x={name:m,amount:parseInt(p,10)};i(x)};return d?e.jsx("div",{className:"modal-overlay",children:e.jsx("div",{className:"modal-content",children:e.jsxs("form",{onSubmit:j,children:[e.jsx("h2",{children:"Tambah Pengeluaran Baru"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"expense-name",children:"Nama Pengeluaran"}),e.jsx("input",{id:"expense-name",type:"text",value:m,onChange:c=>u(c.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"expense-amount",children:"Jumlah (Rp)"}),e.jsx("input",{id:"expense-amount",type:"number",value:p,onChange:c=>h(c.target.value),required:!0})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:o,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn-save",children:"Simpan"})]})]})})}):null}function S({date:d,items:o,type:i,balance:m}){const[u,p]=l.useState(!0),h=o.reduce((r,s)=>r+(i==="income"?s.price*s.quantity:s.amount),0),j=i==="income"?o.reduce((r,s)=>r+(s.price-(s.hpp||0))*s.quantity,0):0,c=()=>i==="income"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Total Transaksi"}),e.jsxs("span",{className:"amount income",children:["+ Rp ",h.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Total Laba"}),e.jsxs("span",{className:"amount income",children:["+ Rp ",j.toLocaleString("id-ID")]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Total Pengeluaran"}),e.jsxs("span",{className:"amount expense",children:["- Rp ",h.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Sisa Saldo"}),e.jsxs("span",{children:["Rp ",m.toLocaleString("id-ID")]})]})]}),x=()=>{if(i==="income"){const r=o.reduce((s,t)=>(s[t.name]||(s[t.name]={...t,quantity:0,total:0}),s[t.name].quantity+=t.quantity,s[t.name].total+=t.price*t.quantity,s),{});return Object.values(r).map(s=>e.jsxs("div",{className:"transaction-item",children:[e.jsxs("span",{children:[s.quantity,"x ",s.name]}),e.jsxs("span",{className:"amount income",children:["+ Rp ",s.total.toLocaleString("id-ID")]})]},`${s.id}-${s.name}`))}return o.map(r=>e.jsxs("div",{className:"transaction-item",children:[e.jsx("span",{children:r.name}),e.jsxs("span",{className:"amount expense",children:["- Rp ",r.amount.toLocaleString("id-ID")]})]},r.id))};return e.jsxs("div",{className:"date-group-accordion",children:[e.jsxs("button",{className:"accordion-header",onClick:()=>p(!u),children:[e.jsx("h3",{children:d}),e.jsx("img",{src:u?"/icons/Arrow-Up-2.svg":"/icons/Arrow-Down-2.svg",alt:"toggle"})]}),u&&e.jsxs("div",{className:"accordion-body",children:[e.jsx("div",{className:"summary-section",children:c()}),e.jsx("div",{className:"item-details-section",children:x()})]})]})}function L(){const[d,o]=l.useState("pemasukan"),[i,m]=l.useState([]),[u,p]=l.useState([]),[h,j]=l.useState(!0),[c,x]=l.useState(!1),r=i.reduce((n,a)=>n+a.price*a.quantity,0),s=u.reduce((n,a)=>n+a.amount,0),t=r-s,y=async()=>{j(!0);try{const[n,a]=await Promise.all([f.from("orders").select("*").order("created_at",{ascending:!1}),f.from("expenses").select("*").order("created_at",{ascending:!1})]);if(n.error)throw n.error;if(a.error)throw a.error;m(n.data),p(a.data)}catch{b.error("Gagal mengambil data riwayat.")}finally{j(!1)}};l.useEffect(()=>{y()},[]);const w=async n=>{try{const{data:{user:a}}=await f.auth.getUser();if(!a){b.error("Sesi tidak valid, silakan login ulang.");return}const v={...n,group_id:"exp_"+Date.now(),user_id:a.id},{error:g}=await f.from("expenses").insert([v]);if(g)throw g;b.success("Pengeluaran berhasil disimpan."),x(!1),y()}catch(a){b.error("Gagal menyimpan pengeluaran: "+a.message)}},N=n=>n.reduce((a,v)=>{const g=new Date(v.created_at).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"});return a[g]||(a[g]=[]),a[g].push(v),a},{}),D=N(i),k=N(u);return h?e.jsx("div",{children:"Memuat data riwayat..."}):e.jsxs("div",{className:"riwayat-page",children:[e.jsx("div",{className:"riwayat-header",children:e.jsxs("div",{className:"tab-container",children:[e.jsx("button",{className:`tab-btn ${d==="pemasukan"?"active":""}`,onClick:()=>o("pemasukan"),children:"Pemasukan"}),e.jsx("button",{className:`tab-btn ${d==="pengeluaran"?"active":""}`,onClick:()=>o("pengeluaran"),children:"Pengeluaran"})]})}),e.jsx("div",{className:"tab-content",children:d==="pemasukan"?Object.entries(D).map(([n,a])=>e.jsx(S,{date:n,items:a,type:"income"},n)):Object.entries(k).map(([n,a])=>e.jsx(S,{date:n,items:a,type:"expense",balance:t},n))}),d==="pengeluaran"&&e.jsx("button",{className:"btn-add-expense-fab",onClick:()=>x(!0),children:e.jsx("img",{src:"/icons/Plus-square.svg",alt:"Tambah Pengeluaran"})}),e.jsx(I,{isOpen:c,onClose:()=>x(!1),onSave:w})]})}export{L as default};
